var vid=vid||{que:[],api:{request:function(vidCont,tags,maxVids,vast,device,pli,resumeOnReload){vid.vid=new paVid.Video(vidCont,tags,maxVids,vast,device,{pli:pli,resumeOnReload:resumeOnReload});for(let func of vid.que){func()}},resize:function(w,h){if(vid.vid){vid.vid.resize(w,h)}else{vid.que.push(function(){vid.vid.resize(w,h)})}},play:function(){if(vid.vid){try{vid.vid.play()}catch(e){console.log("api.play failed: ",e)}}else{console.log("play called before creating")}},pause:function(){vid.vid.pause()},on:function(evt,cb){if(vid.vid){vid.vid.on(evt,cb)}else{if(evt=="ready"){return cb()}vid.que.push(function(){vid.vid.on(evt,cb)})}},mute:function(){if(vid.vid){vid.vid.mute()}else{vid.que.push(function(){vid.vid.mute()})}},unmute:function(){vid.vid.unmute()},getHeight:function(){if(vid.vid){return vid.vid.getHeight()}else{return 360}},stop:function(){return;vid.vid.stop()},removeAllEvts:function(){vid.vid.removeAllEvts()}}};var paVid=paVid||{vidInstances:[],maxWrapper:5,Video:class{constructor(vidCont,tags,maxVids,vast,device,{autoPlay=!0,width=640,height=360,toggleMute=!0,pauseOOV=!1,pli=0,autoResize=!1,refCountStart=0,resumeOnReload=false}={}){this.vidInstanceIndex=paVid.vidInstances.length;paVid.vidInstances.push(this);this.maxVids=maxVids||1;if(!vidCont){return}this.resumeOnReload=resumeOnReload;this.refCountStart=refCountStart;this.autoResize=autoResize;this.pli=parseInt(pli)||0;this.autoPlay=autoPlay;this.toggleMute=toggleMute;this.vidCont=vidCont;this.vids=[];this.is={tag:0,req:0,vid:0,ad:0,cr:0,parsingAd:0};this.info={imp:!1,started:!1,playing:!1,muted:!0,fullscreen:!1,width:width,height:height};this.evts={};this.mobile=!1;this.playOnReady=!0;if(device&&device==="mobile"){this.mobile=!0;paVid.mobile=!0}vidCont.style.background="white";paVid.browser=paVid.getBrowser();paVid.support=paVid.getSupport();if(tags){if(typeof tags==="string"){tags=[{type:"url",url:tags}]}this.tags=tags;this.newVid()}else if(vast){paVid.logError("removed support for VAST in request, please send it url for vast");return}else{paVid.logError("called without url")}this.createTrackingHandlers();if(pauseOOV){var observer=new IntersectionObserver((ent,obs)=>{ent.forEach(e=>{if(this.info.oneAdStarted){if(e.isIntersecting){this.resume()}else{this.pause()}}})},{rootMargin:"0px",threshold:.5});observer.observe(this.vidCont);document.addEventListener("visibilitychange",this.visibilitychanged.bind(this))}}visibilitychanged(){this.mute();document.visibilityState==="hidden"?this.pause():this.resume()}newVid(){if(!this.vidCont){return}this.vidCont.style.pointerEvents="all";if(this.vids[this.is.req]){return}var vidEl=document.createElement("video");vidEl.id="pa-vid-"+this.vidInstanceIndex+"-"+this.is.req;vidEl.style.width=this.info.width+"px";vidEl.style.height=this.info.height+"px";vidEl.style.display="none";vidEl.style.position="static";vidEl.style.transition="left 1s";vidEl.style.background="#3c3d37";vidEl.style.marginTop=0;vidEl.style.marginBottom=0;vidEl.setAttribute("playsinline","");vidEl.setAttribute("muted","");vidEl.setAttribute("volume","0");this.vidCont.appendChild(vidEl);this.vids[this.is.req]={vidEl:vidEl,trackingEvents:paVid.getEmptyEvents(),ads:[],crs:[],ad:null,icon:{},info:{currentWrapper:0}};this.reqAd();if(this.autoResize){window.addEventListener("resize",this.autoResizeFunction.bind(this))}}autoResizeFunction(){this.resize(this.vidCont.parentElement.offsetWidth)}async reqAd(url){if(this.noMoreVids){return}if(!url){if(!this.tags[this.is.tag]){paVid.logError("can't request ad - current tag aint defined");return}if(this.tags[this.is.tag].type=="url"){this.req(this.tags[this.is.tag].url)}else{await paVid.callHBPbjs();paVid.callHB(this.tags[this.is.tag],this.vidInstanceIndex)}}else{this.req(url)}}req(url){if(!url){paVid.logError("no url in req()");this.nextTag();return}paVid.log("requesting ad");if(!this.firstReqSent){this.firstReqSent=!0;this.fireEvt("request");this.fireEvt("ready")}else{this.fireEvt("wrapper")}url=this.replaceMacros(url);if(url.includes("pubads.g.doubleclick.net")){url=this.addGoogleMacros(url);this.createGoogIma();this.googIma.start(url);return}var req=new XMLHttpRequest;req.open("GET",url,!0);var vid=this;req.onreadystatechange=function(){if(req.readyState==4){var res=req.responseXML||"";if(!res){var parser=new DOMParser;res=parser.parseFromString(req.response,"text/xml")||""}if(!paVid.select("VAST",res)||!res){vid.error(100);vid.nextTag();return}vid.vids[vid.is.req].vast=paVid.select("VAST",res)||"";if(vid.vids[vid.is.req].vast){vid.parseRes()}}};req.send()}parseRes(){var ads=paVid.selectAll("Ad",this.vids[this.is.req].vast);if(!ads||!ads[0]){this.error(303);if(paVid.select("VAST > Error",this.vids[this.is.req].vast)){this.track(paVid.selectText("VAST > Error",this.vids[this.is.req].vast))}this.nextTag();return}this.getAds(ads);if(this.vids[this.is.req].ads[this.is.parsingAd]){this.parseAd()}else{this.error(101);this.nextTag();return}}getAds(ads){var standAlone=[],pod=[];for(let ad of ads){if(paVid.att("sequence",ad)){var seq=parseInt(paVid.att("sequence",ad))-1;if(seq&&!pod[seq]){pod[seq]=ad}else{pod.push(ad)}}else{standAlone.push(ad)}}pod=pod.filter(ad=>ad);this.vids[this.is.req].ads=standAlone.concat(pod)}parseAd(){var ad=this.vids[this.is.req].ads[this.is.parsingAd];if(!ad){this.nextTag();return}var inline=paVid.select("InLine",ad);var wrapper=paVid.select("Wrapper",ad);if(paVid.select("Error",ad)){this.vids[this.is.req].trackingEvents.error.push(paVid.selectText("Error",ad))}if(!paVid.select("Impression",ad)){paVid.logError("no impression for this ad");this.nextAd();return}for(let imp of paVid.selectAll("Impression",ad)){this.vids[this.is.req].trackingEvents.impression.push(paVid.selectText(imp))}var adVerification=paVid.select("AdVerification",ad);if(adVerification){if(paVid.select("JavaScriptResource",adVerification)){var script=document.createElement("script");script.src=paVid.selectText("JavaScriptResource",adVerification);this.vidCont.appendChild(script)}}if(wrapper){paVid.logProcess("wrapper");if(this.vids[this.is.req].info.currentWrapper<paVid.maxWrapper){this.vids[this.is.req].info.currentWrapper++;var newTag=paVid.selectText("VASTAdTagURI",ad)||"";if(!newTag){this.error(300);this.nextTag();return}this.reqAd(newTag)}else{this.logError("max wrapper reached ("+paVid.maxWrapper+"), continueing to next tag");this.nextTag();return}var fireErr=!1}this.getCreative(paVid.selectAll("Creatives Creative",ad),fireErr);var cr=this.vids[this.is.req].crs[this.is.cr];if(!cr&&fireErr){this.nextAd();return}if(paVid.select("Icons",cr)){this.fillIconInfo(paVid.select("Icons Icon",cr))}if(paVid.select("Duration",cr)){this.vids[this.is.req].info.totalTime=paVid.timeToMili(paVid.selectText("Duration",cr))}if(paVid.select("TrackingEvents",cr)){this.pushTrackingEvents(paVid.select("TrackingEvents",cr)||[])}if(paVid.select("VideoClicks",cr)){var clickTracking=paVid.select("ClickTracking",cr);if(clickTracking){this.vids[this.is.req].trackingEvents.clickTracking.push(paVid.selectText(clickTracking))}if(paVid.select("ClickThrough",cr)){this.vids[this.is.req].clickThrough=paVid.selectText("ClickThrough",cr);this.vids[this.is.req].vidEl.onclick=this.onclick.bind(this);this.vids[this.is.req].vidEl.style.cursor="pointer"}if(paVid.select("CustomClick",cr)){this.vids[this.is.req].trackingEvents.customClick.push(paVid.selectText("CustomClick",cr))}}if(paVid.select("AdParameters",cr)){this.vids[this.is.req].adParams=paVid.selectText("AdParameters",cr)}else{this.vids[this.is.req].adParams=JSON.stringify({})}if(inline){var mfs=this.getMediaFiles(paVid.selectAll("MediaFiles > MediaFile",cr));var addSourceErrorListener=!1;var addedVidElListeners=!1;for(let mf of mfs){if(paVid.att("apiFramework",mf)&&paVid.att("apiFramework",mf)=="VPAID"){var f=document.createElement("iframe");f.style="display:none;height:0;width:0;opacity:0;";f.id="vpaid_frame_vid-"+this.is.req+"-ad-"+this.is.parsingAd;document.body.appendChild(f);this.vids[this.is.req].f=f;this.vids[this.is.req].fd=f.contentDocument;this.vids[this.is.req].fw=f.contentWindow;var script=document.createElement("script");script.src=paVid.selectText(mf);script.type=paVid.att("type",mf);this.vids[this.is.req].fd.body.appendChild(script);script.addEventListener("load",()=>{this.vpaid()})}else{if(!addedVidElListeners){addedVidElListeners=!0;addSourceErrorListener=!0;this.addVidElListeners()}var src=document.createElement("source");src.src=paVid.selectText(mf);src.type=paVid.att("type",mf);this.vids[this.is.req].vidEl.appendChild(src)}}if(addSourceErrorListener){var sources=paVid.selectAll("source",this.vids[this.is.req].vidEl);if(!sources[0]){this.error(403);this.nextAd();return}sources[sources.length-1].onerror=function(e,b){this.error(400);this.nextAd()}}}else if(!wrapper){this.logError("no ad type (wrapper or inline)");this.error();this.nextTag();return}}onclick(){this.trackingHandlers.click();this.openAd()}getCreative(crs,fireErr){if(fireErr==undefined){fireErr=!0}var tempCrs=[];var skippableLinear=[];var noSkipLinear=[];for(let cr of crs){if(paVid.select("Linear",cr)){tempCrs.push(cr)}else if(paVid.select("NonLinearAds",cr)){paVid.log("found a non-linear (regular image etc) creative")}if(paVid.select("CompanionAds",cr)){paVid.log("there are CompanionAds too!! (ignoring for now)")}}for(let cr of tempCrs){if(paVid.att("skipoffset",paVid.select("Linear",cr))){paVid.log("found a skippable linear ad");paVid.logError("didn't implement skiping mechenism");skippableLinear.push(cr)}else{noSkipLinear.push(cr)}}if(noSkipLinear[0]||skippableLinear[0]){if(skippableLinear[0]){paVid.logError("skippable linear - but mechanism not built")}this.vids[this.is.req].crs=noSkipLinear.concat(skippableLinear)}else{if(fireErr){this.error(201);this.nextAd()}}}getMediaFiles(mfs){var result=[];for(let mf of mfs){if(paVid.att("apiFramework",mf)&&paVid.att("apiFramework",mf)=="VPAID"){if(!paVid.att("type",mf)||paVid.att("type",mf).includes("javascript")){this.vids[this.is.req].info.vpaid={};result.push(mf)}else{paVid.log("throwing away framework: "+paVid.att("type",mf))}}else{if(this.vids[this.is.req].vidEl.canPlayType(paVid.att("type",mf)).replace("no","")){if(paVid.support.includes(paVid.att("type",mf))){result.push(mf)}}else{paVid.logWarn("throwing away type: "+paVid.att("type",mf))}}}return result}pushTrackingEvents(trackingEvents){for(let tr of paVid.selectAll("Tracking",trackingEvents)){var evt=paVid.att("event",tr);if(evt!="progress"){if(!this.vids[this.is.req].trackingEvents[evt]){paVid.logWarn("event ("+evt+") is not in tracking element");continue}this.vids[this.is.req].trackingEvents[evt].push(paVid.selectText(tr))}else{if(paVid.att("offset",tr).includes("%")){this.vids[this.is.req].trackingEvents.progress[paVid.percentToMili(paVid.att("offset",tr),this.vids[this.is.req].info.totalTime)/1e3]=paVid.selectText(tr)}else{this.vids[this.is.req].trackingEvents.progress[Math.round(paVid.timeToMili(paVid.att("offset",tr))/1e3)]=paVid.selectText(tr)}}}}nextTag(){this.is.tag++;this.vids[this.is.req].info.vpaid=!1;this.vids[this.is.req].info.google=!1;if(this.tags[this.is.tag]){this.reqAd()}else{this.noImp()}}nextVid(){this.vids[this.is.vid].complete=!0;if(!this.noMoreVids&&this.vids[this.is.req].vidReadyToPlay){this.playOnReady=!0;this.nextVidReady()}else{this.complete()}}nextAd(){this.is.parsingAd++;if(this.vids[this.is.req].ads[this.is.parsingAd]){this.parseAd()}else{this.nextTag()}}noImp(){paVid.logError("No Impression");if(!this.info.oneAdStarted){this.fireEvt("error")}var type=this.tags[this.is.tag-1]&&this.tags[this.is.tag-1].type||"unknown";var hbTagName=this.tags[this.is.tag-1]&&this.tags[this.is.tag-1].hbTagName||"";paVid.sendReport({type:"req",pl:this.pli||0,partnerName:"video - "+type,refreshCount:this.is.req+(this.refCountStart||0),imp:0,hbTagName:hbTagName,timeDif:Date.now()})}error(code,url){code=code||901;if(url){url=url.replace(/\[ERRORCODE\]/g,code).replace(/\[ERROR_CODE\]/g,code);this.vids[this.is.req].trackingEvents.error.push(url)}this.track(this.vids[this.is.req].trackingEvents.error);paVid.logError(code)}on(evt,cb){if(!this.evts[evt]){this.evts[evt]=[]}this.evts[evt].push(cb)}fireEvt(evt){if(this.evts[evt]){for(let call of this.evts[evt]){call()}}}removeAllEvts(){this.evts={}}hbCallback(err,url,tracks){if(err){paVid.logError("error getting url fromhb");return}this.addHBTracking(tracks);this.reqAd(url)}addHBTracking(tracks){if(!tracks||typeof tracks!=="object")return;Object.entries(tracks).forEach(tr=>{if(!this.vids[this.is.req].trackingEvents[tr[0]]){paVid.logWarn("event ("+tr[0]+") is not in tracking element");return}this.vids[this.is.req].trackingEvents[tr[0]].push(tr[1])})}play(){if(!this.vids[this.is.vid].started){this.vids[this.is.vid].started=!0;if(this.vids[this.is.vid].info.vpaid){this.vids[this.is.vid].vpaidAd.startAd()}else if(this.vids[this.is.vid].info.google){this.vids[this.is.vid].googIma.adsManager.start()}else{this.vids[this.is.vid].vidEl.play()}}else{this.resume()}}pause(){if(this.vids[this.is.vid].info.vpaid){this.vids[this.is.vid].vpaidAd.pauseAd()}else if(this.vids[this.is.vid].info.google){this.vids[this.is.vid].googIma.adsManager.pause()}else{this.vids[this.is.vid].vidEl.pause()}}resume(){if(this.vids[this.is.vid].info.vpaid){this.vids[this.is.vid].vpaidAd.resumeAd()}else if(this.vids[this.is.vid].info.google){this.vids[this.is.vid].googIma.adsManager.resume()}else{this.vids[this.is.vid].vidEl.play()}}stop(){if(this.oneAdStarted){if(this.vids[this.is.vid].info.vpaid){this.vids[this.is.vid].vpaidAd.stopAd()}else if(this.vids[this.is.vid].info.google){this.vids[this.is.vid].googIma.adsManager.stop()}else{this.vids[this.is.vid].vidEl.pause();this.vids[this.is.vid].vidEl.remove()}}else{paVid.log("stop called but vid not started")}}complete(){if(this.info.oneAdStarted){paVid.log("video is complete");this.fireEvt("complete");window.localStorage.removeItem(this.pli+"ror")}else{this.error("no playable ad");this.fireEvt("error")}}mute(i){if(typeof i=="undefined"){i=this.is.vid}this.info.muted=!0;if(!this.vids||!this.vids[i]||!this.vids[i].info){return}if(this.vids[i].info.vpaid){this.vids[i].vpaidAd.setAdVolume(0)}else if(this.vids[i].info.google){this.vids[i].googIma.adsManager.setVolume(0)}else{this.vids[i].vidEl.muted=!0}setTimeout(()=>{this.vids[i].vidEl.muted=!0},10);this.vids[i].vidEl.muted=!0;this.toggleMuteSymbol()}unmute(){this.info.muted=!1;if(this.vids[this.is.vid].info.vpaid){this.vids[this.is.vid].vpaidAd.setAdVolume(.5)}else if(this.vids[this.is.vid].info.google){this.vids[this.is.vid].googIma.adsManager.setVolume(.5)}else{this.vids[this.is.vid].vidEl.muted=!1}this.vids[this.is.vid].vidEl.muted=!1;this.toggleMuteSymbol()}getMute(){return this.info.muted}createMute(){if(!this.toggleMute){paVid.log("toggleMute set to false, returning");return}if(this.muteBtn){return}this.muteBtn=document.createElement("div");this.muteBtn.classList.add("pa-vid-mute-btn");this.muteBtn.style="left: 0px; top: 0px; position: absolute; background: rgb(0,0,0,0.75);color:white;border-radius: 0 0 10px 0;cursor: pointer; transition: transform 0.5s,opacity 1s;z-index:3147483648";this.muteBtn.style.padding="5px";this.muteBtn.style.fontSize="20px";this.muteBtn.style.fontFamily="";this.vidCont.appendChild(this.muteBtn);this.previewMute(1e3);var vid=this;this.muteBtn.addEventListener("click",toggleMute.bind(this));function toggleMute(e){if(this.getMute()){this.unmute();this.toggleMuteSymbol()}else{this.mute();this.toggleMuteSymbol()}e.stopPropagation()}this.toggleMuteSymbol();if(!this.mobile){this.vidCont.addEventListener("mouseenter",this.showMute.bind(this));this.vidCont.addEventListener("mouseleave",this.hideMute.bind(this))}}toggleMuteSymbol(){if(!this.muteBtn){return}if(this.getMute()){this.muteBtn.innerHTML="&#128263"}else{this.muteBtn.innerHTML="&#128266"}}previewMute(){this.showMute();if(!this.mobile){setTimeout(()=>{this.hideMute()},1e3)}}showMute(){this.muteBtn.style.transform="translateY(0)";this.muteBtn.style.opacity=1}hideMute(){this.muteBtn.style.transform="translateY(-100%)";this.muteBtn.style.opacity=0}fillIconInfo(icon){this.vids[this.is.req].icon.info={program:paVid.att("program",icon),width:parseInt(paVid.att("width",icon)),height:parseInt(paVid.att("height",icon)),horizontalPosition:"left",verticalPosition:"top",xPosition:paVid.att("xPosition",icon),yPosition:paVid.att("yPosition",icon),duration:paVid.timeToMili(paVid.att("duration",icon)),offset:paVid.timeToMili(paVid.att("offset",icon)),pxratio:paVid.att("pxratio",icon),apiFramework:paVid.att("apiFramework",icon)};if(paVid.select("StaticResource",icon)){this.vids[this.is.req].icon.info.resourceType="static";this.vids[this.is.req].icon.info.src=paVid.selectText("StaticResource",icon)}else if(paVid.select("IFrameResource",icon)){this.vids[this.is.req].icon.info.resourceType="frame";this.vids[this.is.req].icon.info.src=paVid.selectText("IFrameResource",icon)}else if(paVid.select("HTMLResource",icon)){this.vids[this.is.req].icon.info.resourceType="html";this.vids[this.is.req].icon.info.html=paVid.selectText("HTMLResource",icon)}var iconClicks=paVid.select("Iconclicks",icon);if(iconClicks){if(paVid.select("IconClickThrough",icon)){this.vids[this.is.req].icon.info.clickThrough=paVid.selectText("IconClickThrough",icon)}if(paVid.select("IconClickTracking",icon)){this.vids[this.is.req].icon.info.clickTracking=paVid.selectText("IconClickTracking",icon)}if(paVid.select("IconViewTracking",icon)){this.vids[this.is.req].icon.info.iconViewTracking=paVid.selectText("IconViewTracking",icon)}}if(this.vids[this.is.req].icon.info.xPosition=="left"){this.vids[this.is.req].icon.info.xPosition=0}else if(this.vids[this.is.req].icon.info.xPosition=="right"){this.vids[this.is.req].icon.info.xPosition=0;this.vids[this.is.req].icon.info.horizontalPosition="right"}if(this.vids[this.is.req].icon.info.yPosition=="top"){this.vids[this.is.req].icon.info.yPosition=0}else if(this.vids[this.is.req].icon.info.yPosition=="bottom"){this.vids[this.is.req].icon.info.yPosition=0;this.vids[this.is.req].icon.info.vericalPosition="bottom"}this.vids[this.is.req].icon.info.xPosition=parseInt(this.vids[this.is.req].icon.info.xPosition);this.vids[this.is.req].icon.info.yPosition=parseInt(this.vids[this.is.req].icon.info.yPosition)}showIcon(){if(!this.vids[this.is.vid].icon.info){return}var iconElmType;switch(this.vids[this.is.vid].icon.info.resourceType){case"static":iconElmType="img";break;case"frame":iconElmType="iframe";break;case"html":iconElmType="iframe";break}var icon=document.createElement(iconElmType);var iconAnchor=document.createElement("a");iconAnchor.style.zIndex=1;iconAnchor.target="_blank";iconAnchor.style.position="absolute";iconAnchor.style.width=this.vids[this.is.vid].icon.info.width+"px";iconAnchor.style.height=this.vids[this.is.vid].icon.info.height+"px";iconAnchor.style[this.vids[this.is.vid].icon.info.horizontalPosition]=this.vids[this.is.vid].icon.info.xPosition+"px";iconAnchor.style[this.vids[this.is.vid].icon.info.verticalPosition]=this.vids[this.is.vid].icon.info.yPosition+"px";icon.width=this.vids[this.is.vid].icon.info.width;icon.height=this.vids[this.is.vid].icon.info.height;icon.style.width="100%";icon.style.height="100%";iconAnchor.href=this.vids[this.is.vid].icon.info.clickThrough;if(this.vids[this.is.vid].icon.info.clickTracking){iconAnchor.onclick=function(){this.vids[this.is.vid].trackingHandlers.iconClick()}}if(this.vids[this.is.vid].icon.info.resourceType=="html"){try{icon.open();icon.write(this.vids[this.is.vid].icon.info.html);icon.close()}catch(e){paVid.logError("couldn't write the icon")}}else{icon.src=this.vids[this.is.vid].icon.info.src}setTimeout(()=>{this.vidCont.insertAdjacentElement("afterbegin",iconAnchor);iconAnchor.appendChild(icon);if(this.vids[this.is.vid].icon.info.iconViewTracking){this.vids[this.is.vid].trackingHandlers.iconView()}if(this.vids[this.is.vid].icon.info.duration){setTimeout(()=>{try{icon.remove()}catch(e){}},this.vids[this.is.vid].icon.info.duration)}},this.vids[this.is.vid].icon.info.offset)}getHeight(){return this.info.height}resize(w,h){if(w&&h){this.info.resizeTries=0}if(!w){w=this.info.width}if(!h){h=w*.5625}this.info.width=w;this.info.height=h;if(!this.vids[0]){return}if(this.vids[this.is.vid].info.vpaid){this.vids[this.is.vid].vpaidAd.resizeAd(this.info.width,this.info.height,"normal")}else if(this.vids[this.is.vid].info.google){this.vids[this.is.vid].googIma.adsManager.resize(this.info.width,this.info.height,"normal");this.vids[this.is.vid].vidEl.width=this.info.width;this.vids[this.is.vid].vidEl.style.width=this.info.width+"px";this.vids[this.is.vid].vidEl.height=this.info.height;this.vids[this.is.vid].vidEl.style.height=this.info.height+"px"}else{this.vids[this.is.vid].vidEl.width=this.info.width;this.vids[this.is.vid].vidEl.style.width=this.info.width+"px";this.vids[this.is.vid].vidEl.height=this.info.height;this.vids[this.is.vid].vidEl.style.height=this.info.height+"px"}}prepareNextVid(){if(this.vids[this.is.vid].info.nextVidPrepareCalled){paVid.logWarn("prepareNextVid called again");return}if(this.is.req+1>=this.maxVids){this.noMoreVids=!0;paVid.log("reached max loop");return}this.vids[this.is.vid].info.nextVidPrepareCalled=!0;if(this.getTimeLeft()<5500){paVid.log("preparing next vid now");this.reqNextVid()}else{paVid.log("scheduling call for next vid");setTimeout(()=>{this.reqNextVid()},this.getTimeLeft()-5e3)}}reqNextVid(){this.is.parsingAd=0;this.is.tag=0;this.is.req++;this.newVid()}nextVidReady(){if(this.noMoreVids){return}if(this.playOnReady){if(this.resumeOnReload){if(this.is.req>0&&this.vids[this.is.vid]){window.localStorage.removeItem(this.pli+"ror")}else{var ror=window.localStorage.getItem(this.pli+"ror");if(ror){if(ror>this.getTimeLeft()/1e3){window.localStorage.setItem(this.pli+"ror",0);ror=0}this.vids[this.is.req].vidEl.currentTime=ror||0}}}this.playOnReady=!1;this.oneAdStarted=!0;if(this.is.req>0&&this.vids[this.is.vid]){if(this.vids[this.is.vid].info.google){this.vids[this.is.vid].vidCont.remove()}else{this.vids[this.is.vid].vidEl.remove()}if(this.vids[this.is.vid].vpaid){this.removeVPAIDHandlers()}}this.is.vid=this.is.req;this.vids[this.is.vid].vidEl.style.display="block";if(this.vids[this.is.vid].info.google){this.vids[this.is.vid].vidCont.style.display="block";this.vids[this.is.vid].vidEl.style.display="inline";this.vids[this.is.vid].vidCont.style.transition="left 1s";this.vids[this.is.vid].vidCont.prepend(this.vids[this.is.vid].vidEl);this.vids[this.is.vid].vidEl.nextElementSibling.style.top=0}if(this.vids[this.is.vid].info.google){this.vids[this.is.vid].vidCont.style.left=this.info.width+"px";setTimeout(()=>{this.vids[this.is.vid].vidCont.style.left=0},0)}this.vids[this.is.vid].vidEl.style.left=this.info.width+"px";setTimeout(()=>{this.vids[this.is.vid].vidEl.style.left=0},0);this.mute();setTimeout(()=>{if(this.autoPlay){this.play()}else{paVid.log("autoPlay false, waiting for play call")}},150);this.fireEvt("nextVid")}else{this.vids[this.is.req].vidReadyToPlay=!0}}createTrackingHandlers(){var vid=this;this.trackingHandlers={click:function(){this.track(this.vids[this.is.vid].trackingEvents.clickTracking);paVid.logTrack("clickTracking")}.bind(this),iconClick:function(){this.track(this.vids[this.is.vid].icon.info.clickTracking);paVid.logTrack("Icon Click")}.bind(this),iconView:function(){this.track(this.vids[this.is.vid].icon.info.iconViewTracking);paVid.logTrack("Icon View")}.bind(this),impression:function(){this.track(this.vids[this.is.vid].trackingEvents.impression);paVid.logTrack("impression");this.track(this.vids[this.is.vid].trackingEvents.creativeView);paVid.logTrack("creativeView");var type=this.tags[this.is.tag]&&this.tags[this.is.tag].type||"unknown";var hbTagName=this.tags[this.is.tag]&&this.tags[this.is.tag].hbTagName||"";paVid.sendReport({type:"req",pl:this.pli||0,partnerName:"video - "+type,refreshCount:this.is.vid+(this.refCountStart||0),imp:1,hbTagName:hbTagName})}.bind(this),start:function(){this.track(this.vids[this.is.vid].trackingEvents.start);paVid.logTrack("start")}.bind(this),pause:function(){this.track(this.vids[this.is.vid].trackingEvents.pause);paVid.logTrack("pause")}.bind(this),resume:function(){this.track(this.vids[this.is.vid].trackingEvents.resume);paVid.logTrack("resumed")}.bind(this),fullscreen:function(){this.track(this.vids[this.is.vid].trackingEvents.fullscreen);this.track(this.vids[this.is.vid].trackingEvents.playerExpand);paVid.logTrack("fullscreen")}.bind(this),exitFullscreen:function(){this.track(this.vids[this.is.vid].trackingEvents.exitFullscreen);this.track(this.vids[this.is.vid].trackingEvents.playerCollapse);paVid.logTrack("exit fullscreen")}.bind(this),mute:function(){this.track(this.vids[this.is.vid].trackingEvents.mute);paVid.logTrack("mute")}.bind(this),unmute:function(){this.track(this.vids[this.is.vid].trackingEvents.unmute);paVid.logTrack("unmute")}.bind(this),firstQuartile:function(){this.track(this.vids[this.is.vid].trackingEvents.firstQuartile);paVid.logTrack("firstQuartile")}.bind(this),midpoint:function(){this.track(this.vids[this.is.vid].trackingEvents.midpoint);paVid.logTrack("midpoint")}.bind(this),thirdQuartile:function(){this.track(this.vids[this.is.vid].trackingEvents.thirdQuartile);paVid.logTrack("thirdQuartile")}.bind(this),complete:function(){this.track(this.vids[this.is.vid].trackingEvents.complete);paVid.logTrack("complete")}.bind(this)}}openAd(){top.window.open(this.vids[this.is.vid].clickThrough,"_blank")}addVidElListeners(){this.vids[this.is.req].vidEl.onerror=function(e){this.error();this.nextTag();return}.bind(this);this.vids[this.is.req].vidEl.onplay=function(){if(!this.vids[this.is.vid].info.started){if(!this.info.oneAdStarted){this.fireEvt("impression")}this.vids[this.is.req].info.started=!0;this.info.oneAdStarted=!0;this.trackingHandlers.impression();this.fireEvt("start");this.trackingHandlers.start();this.showIcon();this.createMute();this.prepareNextVid()}else{this.trackingHandlers.resume()}}.bind(this);var fullscreenListeners=["webkitfullscreenchange","mozfullscreenchange","fullscreenchange"];for(let i of fullscreenListeners){this.vids[this.is.req].vidEl.addEventListener(i,fullscreenFun.bind(this))}function fullscreenFun(e){if(!this.vids[this.is.vid].info.fullscreen&&document.fullscreenElement==this.vids[this.is.vid].vidEl){this.vids[this.is.vid].info.fullscreen=!0;this.trackingHandlers.fullscreen()}else if(this.vids[this.is.vid].info.fullscreen){this.vids[this.is.vid].info.fullscreen=!1;this.vids[this.is.vid].trackingHandlers.exitFullscreen()}}this.vids[this.is.req].vidEl.onpause=function(e){if(!this.vids[this.is.vid].info.ended){this.trackingHandlers.pause()}}.bind(this);this.vids[this.is.req].vidEl.onvolumechange=function(e){if(this.vids[this.is.vid].vidEl.volume==0||this.vids[this.is.vid].vidEl.muted){if(!this.info.muted){this.trackingHandlers.mute()}this.toggleMuteSymbol();this.info.muted=!0}else if(this.vids[this.is.vid].vidEl.volume>0&&this.info.muted){this.trackingHandlers.unmute();this.info.muted=!1;this.toggleMuteSymbol()}}.bind(this);this.vids[this.is.req].vidEl.ontimeupdate=function(e){var currentTime=parseFloat((Math.floor(this.vids[this.is.vid].vidEl.currentTime*4)/4).toFixed(2));if(currentTime<this.vids[this.is.vid].info.currentTime){this.track(this.vids[this.is.vid].trackingEvents.rewind);paVid.logTrack("Rewind")}if(currentTime!=this.vids[this.is.vid].info.currentTime){this.vids[this.is.vid].info.currentTime=currentTime;this.timeChange()}}.bind(this);this.vids[this.is.req].vidEl.onended=function(e){this.trackingHandlers.complete();this.nextVid()}.bind(this);function startVid(){if(this.vids[this.is.req].startVidCalled){return}this.vids[this.is.req].startVidCalled=!0;if(!this.vids[this.is.req].info.started){this.vids[this.is.req].info.playing=!0;this.vids[this.is.req].info.quarters=[];this.vids[this.is.req].info.currentTime=Math.floor(this.vids[this.is.req].vidEl.currentTime);for(let i=1;i<=3;i++){this.vids[this.is.req].info.quarters.push(parseFloat((Math.round(this.vids[this.is.req].vidEl.duration)*4/4).toFixed(2)/4*i))}if(this.info.muted){this.mute()}this.nextVidReady()}}this.vids[this.is.req].vidEl.oncanplay=startVid.bind(this);this.vids[this.is.req].vidEl.onloadedmetadata=startVid.bind(this)}timeChange(){if(this.vids[this.is.vid].trackingEvents.progress[this.vids[this.is.vid].info.currentTime]){this.track(this.vids[this.is.vid].trackingEvents.progress[this.vids[this.is.vid].info.currentTime]);paVid.logTrack("tracking on: "+this.vids[this.is.vid].info.currentTime)}switch(this.vids[this.is.vid].info.currentTime){case this.vids[this.is.vid].info.quarters[0]:this.trackingHandlers.firstQuartile();break;case this.vids[this.is.vid].info.quarters[1]:this.trackingHandlers.midpoint();break;case this.vids[this.is.vid].info.quarters[2]:this.trackingHandlers.thirdQuartile();break}window.localStorage.setItem(this.pli+"ror",this.vids[this.is.vid].info.currentTime)}getTimeLeft(){if(this.vids[this.is.vid].info.google){return this.vids[this.is.req].googIma.adsManager.getRemainingTime()*1e3}if(this.vids[this.is.vid].vidEl.duration){return this.vids[this.is.vid].vidEl.duration*1e3-this.vids[this.is.vid].vidEl.currentTime}else{return this.vids[this.is.vid].info.totalTime-this.vids[this.is.vid].vidEl.currentTime}}track(urls){if(!this.trDiv){this.trDiv=document.createElement("div");this.trDiv.style="display:none;opacity:0;height:0;width:0;";this.trDiv.id="pa-vid-tracking-div";this.vidCont.appendChild(this.trDiv)}if(!urls){return}if(typeof urls=="string"){urls=[urls]}try{urls=urls.filter(x=>x)}catch(e){return}if(!urls.length){return}for(let url of urls){var frame=document.createElement("iframe");frame.style="display:none;opacity:0;height:0;width:0;";frame.src=url;this.trDiv.appendChild(frame)}}replaceMacros(url){return url.replace("[WIDTH]",this.info.width).replace("{{WIDTH}}",this.info.width).replace("[HEIGHT]",this.info.height).replace("{{HEIGHT}}",this.info.height).replace("[CACHEBUSTER]",Math.random()).replace("{{CACHEBUSTER}}",Math.random()).replace("[DOMAIN]",window.location.href).replace("{{DOMAIN}}",window.location.href)}addGoogleMacros(url){if(!url.includes("?"))url+="?";url+=`&ad_type=${"video"}&client=${document.domain}&description_url=${encodeURIComponent(window.location.href)}`;const videoTitle="NM video";url+=`&slotname=${""}&videoad_start_delay=${0}&hl=${"en"}&max_ad_duration=${3e4}&min_ad_duration=${0}&sdmax=${12e4}&vid_t=${videoTitle}&vid_d=${900}&vid_kw=${""}&vpa=${"auto"}&vpmute=${1}`;return url}vpaid(){if(this.vids[this.is.req].vpaidCalled){return}this.vids[this.is.req].vpaidCalled=!0;if(!this.vids[this.is.req].fw.getVPAIDAd){this.error(901);this.nextTag();paVid.logError("getVPAIDAd not defined");return}this.vids[this.is.req].vpaidAd=this.vids[this.is.req].fw.getVPAIDAd();this.vids[this.is.req].vidEl.onclick=null;var environmentVars={videoSlotCanAutoPlay:!0};environmentVars.slot=this.vidCont;environmentVars.videoSlot=this.vids[this.is.req].vidEl;var creativeData={};creativeData.AdParameters=this.vids[this.is.req].adParams;try{var version=this.vids[this.is.req].vpaidAd.handshakeVersion("2.0").split(".").map(x=>parseInt(x));if(version[0]>2){paVid.logError("PA video doesn't support VPAID version");this.error();this.nextTag();return}}catch(e){paVid.logError("can't get VPAID version");this.error();this.nextTag();return}this.addVPAIDHandlers();this.vids[this.is.req].vpaidAd.initAd(this.info.width,this.info.height,"normal",500,creativeData,environmentVars)}addVPAIDHandlers(){this.vpaidEventsHandlers={AdLoaded:function(){paVid.logVPAID("ad loaded");this.mute(this.is.req);this.nextVidReady()}.bind(this),AdStarted:function(){paVid.logVPAID("ad started");if(!this.vids[this.is.vid].info.vpaid.adStartedFired){this.vids[this.is.req].info.started=!0;this.vids[this.is.vid].info.vpaid.adStartedFired=!0;this.info.oneAdStarted=!0;this.trackingHandlers.start();this.createMute();this.prepareNextVid()}}.bind(this),AdStopped:function(){paVid.logVPAID("ad stopped")}.bind(this),AdSkipped:function(){paVid.logVPAID("Ad skipped");this.fireEvt("skipped");this.noMoreVids=!0;this.nextVid()}.bind(this),AdVolumeChange:function(){paVid.logVPAID("volume changed");var muted=this.vids[this.is.req].vpaidAd.getAdVolume()==0;if(this.info.muted&&!muted){this.info.muted=!1;this.trackingHandlers.unmute();this.toggleMuteSymbol()}else if(!this.info.muted&&muted){this.info.muted=!0;this.trackingHandlers.mute();this.toggleMuteSymbol()}}.bind(this),AdImpression:function(){if(!this.vids[this.is.vid].info.vpaid.impFired){this.vids[this.is.vid].info.vpaid.impFired=!0;paVid.logVPAID("impression");this.fireEvt("impression");this.trackingHandlers.impression()}else{paVid.logWarn("vpaid fired impression again :(")}}.bind(this),AdVideoStart:function(){if(!this.vids[this.is.vid].info.vpaid.adStartedFired){this.vids[this.is.vid].info.vpaid.adStartedFired=!0;this.info.oneAdStarted=!0;this.fireEvt("start");this.trackingHandlers.start();this.prepareNextVid()}}.bind(this),AdVideoFirstQuartile:function(){this.trackingHandlers.firstQuartile()}.bind(this),AdVideoMidPoint:function(){this.trackingHandlers.midpoint()}.bind(this),AdVideoThirdQuartile:function(){this.trackingHandlers.thirdQuartile()}.bind(this),AdVideoComplete:function(){paVid.logVPAID("complete");this.trackingHandlers.complete();this.nextVid()}.bind(this),AdClickThru:function(url,id,playerHandles){this.trackingHandlers.click();if(playerHandles){paVid.log("Player handles clickThrough");if(url){this.clickThrough=url}this.openAd()}}.bind(this),AdPaused:function(){this.trackingHandlers.pause()}.bind(this),AdPlaying:function(){this.trackingHandlers.resume()}.bind(this),AdInteraction:function(){}.bind(this),adUserAcceptInvitation:function(){}.bind(this),AdUserMinimize:function(){}.bind(this),AdUserClose:function(){this.noMoreVids=!0;this.nextVid()}.bind(this),AdSkippableStateChange:function(){}.bind(this),AdSizeChange:function(){if(this.vids[this.is.vid].vidEl.offsetWidth>this.info.width||this.vids[this.is.vid].vidEl.offsetHeight>this.info.height){this.vids[this.is.vid].vidEl.style.maxWidth=this.info.width+"px";this.vids[this.is.vid].vidEl.style.maxHeight=this.getHeight()+"px"}else{this.vids[this.is.vid].vidEl.style.maxWidth="";this.vids[this.is.vid].vidEl.style.maxHeight=""}}.bind(this),AdLinearChange:function(){}.bind(this),AdDurationChange:function(){}.bind(this),AdExpandedChange:function(){}.bind(this),AdremainingTimeChange:function(){}.bind(this),AdLog:function(message){paVid.logVPAID(message);console.log(message)}.bind(this),AdError:function(e){if(!this.vids[this.is.req].vpaidErrFired){return}this.vids[this.is.req].vpaidErrFired=!0;console.error(e);this.cleanVid();this.error(900);this.error("VPAID Error!");this.nextTag()}.bind(this)};for(let evt in this.vpaidEventsHandlers){this.vids[this.is.req].vpaidAd.subscribe(this.vpaidEventsHandlers[evt],evt)}}createGoogIma(){this.googIma={start:function(url){console.log("Google IMA");this.vids[this.is.req].googIma={};var f=document.createElement("iframe");f.id="pa-vid-goog-ima-sdk-"+paVid.vidInstances.length+"-"+this.is.req+"-"+this.is.tag;f.style.display="none";document.body.appendChild(f);this.vids[this.is.req].googIma.fd=f.contentDocument;this.vids[this.is.req].googIma.fw=f.contentWindow;var s=document.createElement("script");s.src="https://imasdk.googleapis.com/js/sdkloader/ima3.js";this.vids[this.is.req].googIma.fd.body.appendChild(s);s.onload=function(){this.googIma.init(url)}.bind(this)}.bind(this),init:function(url){if(!this.vids[this.is.req].googIma.fw.google){paVid.logError("google not defined in google frame");this.nextTag();return}this.vids[this.is.req].info.google=!0;var div=document.createElement("div");this.vidCont.appendChild(div);div.style="width: inherit; height: inherit;position:relative;";div.id="goog-ima-"+paVid.vidInstances.length+"-"+this.is.req;div.style.display="none";this.vids[this.is.req].vidCont=div;div.appendChild(this.vids[this.is.req].vidEl);this.vids[this.is.req].googIma.adDisplayContainer=new this.vids[this.is.req].googIma.fw.google.ima.AdDisplayContainer(div,this.vids[this.is.req].vidEl);this.vids[this.is.req].googIma.adsLoader=new this.vids[this.is.req].googIma.fw.google.ima.AdsLoader(this.vids[this.is.req].googIma.adDisplayContainer);this.vids[this.is.req].googIma.adsRequest=new this.vids[this.is.req].googIma.fw.google.ima.AdsRequest;this.vids[this.is.req].googIma.adsRequest.adTagUrl=url;this.vids[this.is.req].googIma.adsRequest.linearAdSlotWidth=this.info.width;this.vids[this.is.req].googIma.adsRequest.linearAdSlotHeight=this.info.height;this.vids[this.is.req].googIma.adsRequest.setAdWillAutoPlay(true);this.vids[this.is.req].googIma.adsRequest.setAdWillPlayMuted(true);this.vids[this.is.req].googIma.adsRequest.setContinuousPlayback(true);this.vids[this.is.req].googIma.adsLoader.requestAds(this.vids[this.is.req].googIma.adsRequest);this.vids[this.is.req].googIma.adsLoader.addEventListener("adsManagerLoaded",this.googIma.onAdsManagerLoaded,!1);this.vids[this.is.req].googIma.adsLoader.addEventListener("adError",this.googIma.onError,!1)}.bind(this),onAdsManagerLoaded:function(e){this.vids[this.is.req].googIma.adsManager=e.getAdsManager(this.vids[this.is.req].vidEl);if(this.vids[this.is.req].googIma.adsManager){this.vids[this.is.req].googIma.adsManager.addEventListener("adError",this.googIma.onError);this.vids[this.is.req].googIma.adsManager.addEventListener("loaded",this.googIma.onLoaded);this.vids[this.is.req].googIma.adsManager.addEventListener("start",this.googIma.onStart);this.vids[this.is.req].googIma.adsManager.addEventListener("complete",this.googIma.onComplete);this.vids[this.is.req].googIma.adsManager.addEventListener("skipped",this.googIma.onUserClose);this.vids[this.is.req].googIma.adsManager.addEventListener("skip",this.googIma.onUserClose);this.vids[this.is.req].googIma.adsManager.addEventListener("user_close",this.googIma.onUserClose);this.vids[this.is.req].googIma.adsManager.addEventListener("impression",this.googIma.onImpression);this.vids[this.is.req].googIma.adsManager.addEventListener("click",this.googIma.onClick);this.vids[this.is.req].googIma.adsManager.addEventListener("firstQuartile",this.googIma.onFirstQuartile);this.vids[this.is.req].googIma.adsManager.addEventListener("midpoint",this.googIma.onMidpoint);this.vids[this.is.req].googIma.adsManager.addEventListener("thirdQuartile",this.googIma.onThirdQuartile);this.googIma.loadAd()}else{this.googIma.cleanAndNextTag()}}.bind(this),loadAd:function(){this.vids[this.is.req].googIma.adDisplayContainer.initialize();this.vids[this.is.req].googIma.adsManager.init(this.info.width,this.info.height,"normal")}.bind(this),onPauseRequest:function(){}.bind(this),onResumeRequest:function(){}.bind(this),onLoaded:function(e){var ad=e.getAd();if(!ad.isLinear()){this.googIma.cleanAndNextTag()}else{if(this.is.req==0){this.playOnReady=!0;this.firstVidStarted=!1;this.vids[this.is.req].started=!1}this.nextVidReady()}}.bind(this),cleanAndNextTag:function(){console.log("cleanAndNextTag");this.googIma.destroy();this.vidCont.appendChild(this.vids[this.is.req].vidEl);this.vids[this.is.req].vidCont.remove();this.nextTag()}.bind(this),destroy:function(i){if(typeof i=="undefined"){i=this.is.req}if(this.vids[i].googIma.adsManager){this.vids[i].googIma.adsManager.destroy()}}.bind(this),onError:function(e){console.log("googIma error");console.log(e);console.log(e.getError());this.googIma.cleanAndNextTag()}.bind(this),onComplete:function(){this.trackingHandlers.complete();this.googIma.destroy(this.is.vid);this.nextVid()}.bind(this),onUserClose:function(){if(!this.vids[this.is.vid].googIma.userCloseFired){this.vids[this.is.vid].googIma.userCloseFired=!0;console.log("onUserClose");this.noMoreVids=!0;this.googIma.destroy();this.nextVid()}}.bind(this),onStart:function(){this.fireEvt("start");this.trackingHandlers.start();this.vids[this.is.req].info.started=!0;this.info.oneAdStarted=!0;this.createMute();this.prepareNextVid()}.bind(this),onImpression:function(){if(!this.vids[this.is.vid].googIma.impFired){this.vids[this.is.vid].googIma.impFired=!0;this.fireEvt("impression");this.trackingHandlers.impression()}else{paVid.logWarn("google fired impression again :(")}}.bind(this),onClick:function(){this.trackingHandlers.click()}.bind(this),onFirstQuartile:function(){this.trackingHandlers.firstQuartile()}.bind(this),onMidpoint:function(){this.trackingHandlers.midpoint()}.bind(this),onThirdQuartile:function(){this.trackingHandlers.thirdQuartile()}.bind(this)}}},callHBPrebid:function(){if(window.pa_prebid_fw){return}const pbjsFrame=document.createElement("iframe");pbjsFrame.src="about:blank";pbjsFrame.setAttribute("frameborder","0");pbjsFrame.setAttribute("marginwidth","0");pbjsFrame.setAttribute("marginheight","0");pbjsFrame.setAttribute("scrolling","no");pbjsFrame.style.display="none";pbjsFrame.id=`pa-prebid-frame`;document.body.appendChild(pbjsFrame);const pbjsFrameD=pbjsFrame.contentDocument;pbjsFrameD.open();pbjsFrameD.write(`
    <script>var PWT = {};var pbjs = pbjs || {};pbjs.que = pbjs.que || [];var prebidLoaded = false;PWT.isLoaded = function(){loadPrebid();};var loadPrebid = function(){if (!prebidLoaded) {prebidLoaded = true;var pbs = document.createElement("script");pbs.type = "text/javascript";pbs.async = true;pbs.src = "https://hb.brainlyads.com/prebid.js";document.head.appendChild(pbs);}};setTimeout(loadPrebid, 100);(function() {var purl = window.location.href;var url = "//ads.pubmatic.com/AdServer/js/pwt/157577/2378/";var profileVersionId = "";if(purl.indexOf("pwtv=")>0){var regexp = /pwtv=(.*?)(&|$)/g;var matches = regexp.exec(purl);if(matches.length >= 2 && matches[1].length > 0){profileVersionId = "/"+matches[1];}}var wtads = document.createElement("script");wtads.async = true;wtads.type = "text/javascript";wtads.src = url+profileVersionId+"/pwt.js";var node = document.getElementsByTagName("script")[0];node.parentNode.insertBefore(wtads, node);})();</script></head><body></body></html>`);pbjsFrameD.close();window.pa_prebid_fw=pbjsFrame.contentWindow},pbjsWrapperLoaded:function(){paVid.pbjsLoaded=true;const evt=new Event("wPbjsLoaded");document.dispatchEvent(evt)},callHBPbjs:function(){return new Promise((res,rej)=>{paVid.callHBPrebid();if(window.pa_pbjs_fw||window.paGlobal){return res()}const pbjsFrame=document.createElement("iframe");pbjsFrame.src="about:blank";pbjsFrame.setAttribute("frameborder","0");pbjsFrame.setAttribute("marginwidth","0");pbjsFrame.setAttribute("marginheight","0");pbjsFrame.setAttribute("scrolling","no");pbjsFrame.style.display="none";pbjsFrame.id=`pa-pbjs-frame`;document.body.appendChild(pbjsFrame);const pbjsFrameD=pbjsFrame.contentDocument;window.pa_pbjs_fw=pbjsFrame.contentWindow;pbjsFrameD.open();pbjsFrameD.write(`<html><head><script>var pbjs = parent.pa_prebid_fw.pbjs;</script><script src="https://hb.brainlyads.com/pbjs_wrapper.v${paVid.pbjsWrapperV}.js" onload="parent.paVid.pbjsWrapperLoaded()"></script></head><body></body></html>`);pbjsFrameD.close();return res()})},callHB:async function(tag,vidInstanceIndex){var f=document.createElement("iframe");f.src="about:blank";f.id="vid-hb-call-"+vidInstanceIndex+"-"+paVid.vidInstances[vidInstanceIndex].is.req;f.style="display:none;opacity:0;height:0;width:0;";document.body.appendChild(f);var fd=f.contentDocument;let parts=await paVid.getHBData(tag.linkNumber);if(!parts){paVid.vidInstances[vidInstanceIndex].hbCallback("failed to parse response")}paVid.vidInstances[vidInstanceIndex].tags[paVid.vidInstances[vidInstanceIndex].is.tag].hbTagName=parts.code||"";function writeCb(params){fd.open();fd.write(`<html><head>${parts.head}<script>function vastAd(url, el){console.log('vastAd',url,el);parent.paVid.vidInstances[${vidInstanceIndex}].hbCallback(null,url);};</script></head><body>${parts.body}</body></html>`);fd.close();if(paVid.pbjsWrapperV=="2.0"){paVid.callWaitingHBAuctionIds()}}if(paVid.checkPbjsLoaded()){writeCb()}else{console.log("hb write for video reqady before loaded");document.addEventListener("wPbjsLoaded",()=>{writeCb()})}},getAuctionId:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)})},getHBIds:function(){const auctionId=paVid.getAuctionId();return{auctionId:auctionId,uniqId:auctionId.split("-")[1]}},replaceHBMacros:function(parts){let result={};const ids=paVid.getHBIds();if(paVid.pbjsWrapperV=="2.0"){paVid.auctionIdsToCall.push(ids.auctionId)}Object.entries(parts).forEach(x=>{if(typeof x[1]!=="string")return result[x[0]]=x[1];result[x[0]]=x[1].replace(/\[\[AUCTION_ID\]\]/g,ids.auctionId).replace(/\[\[UNIQ_ID\]\]/g,ids.uniqId).replace(/\"\[\[UNIT_SIZES\]\]\"/g,"[[UNIT_SIZES]]").replace(/\[\[UNIT_SIZES\]\]/g,JSON.stringify([])).replace(/\[\[CUSTOM_TARGETINGS\]\]/g,JSON.stringify([]))});return result},hbData:{},getHBData:function(linkNumber){if(window.paGlobal&&paGlobal.hbData[linkNumber])paVid.hbData[linkNumber]=paGlobal.hbData[linkNumber];return new Promise(async(res,rej)=>{if(paVid.hbData[linkNumber]){return res(paVid.replaceHBMacros(paVid.hbData[linkNumber]))}await paVid.requestHBData(linkNumber);res(paVid.replaceHBMacros(paVid.hbData[linkNumber]))})},auctionIdsToCall:[],checkPbjsLoaded:function(){if(window.paGlobal){return paGlobal.pbjsLoaded}return paVid.pbjsLoaded},callWaitingHBAuctionIds:function(){try{if(!paVid.checkPbjsLoaded()){console.warn("HB is ready to call before wPbjs (wrapper) loaded - adding loaded event");document.addEventListener("wPbjsLoaded",()=>{paGlobal.callWaitingHBAuctionIds()});return}window.pa_pbjs_fw.wPbjs.run(paVid.auctionIdsToCall);paVid.auctionIdsToCall=[]}catch(e){console.error("failed the call to hb: ",e)}},pbjsWrapperV:window.paGlobal&&window.paGlobal.pbjsWrapperV||"1.1",requestHBDataPromises:{},requestHBData:function(linkNumber){if(paVid.requestHBDataPromises[linkNumber]){return paVid.requestHBDataPromises[linkNumber]}paVid.requestHBDataPromises[linkNumber]=new Promise((res,rej)=>{fetch(`https://hb.brainlyads.com/json-parts/${linkNumber}/?ver=${paVid.pbjsWrapperV}&pageId=${window.paGlobal&&window.paGlobal.pageId||""}&winbidder=${JSON.stringify(window.hb_win&&window.hb_win[linkNumber])||""}`).then(x=>x.json()).then(resp=>{paVid.hbData[linkNumber]=resp;res()}).catch(e=>{console.warn("failed to fetch hb ("+linkNumber+")! ",e)})});return paVid.requestHBDataPromises[linkNumber]},log:function(t){if(paVid.debug||window.paGlobal&&paGlobal.debug){console.log("%cINFO: ","color:black;background:lightblue;font-weight:bolder;padding:2px;",t)}},logTrack:function(t){if(paVid.debug||window.paGlobal&&paGlobal.debug){console.log("%cTrack: ","color:white;background:lightgreen;font-weight:bolder;padding:2px;",t)}},logProcess:function(t){if(paVid.debug||window.paGlobal&&paGlobal.debug){console.log("%cProcess: ","color:blue;background:lightblue;font-weight:bolder;padding:2px;",t)}},logError:function(t){if(paVid.debug||window.paGlobal&&paGlobal.debug){console.log("%cError: ","color:white;background:red;font-weight:bolder;padding:2px;",t)}},logVPAID:function(t){if(paVid.debug||window.paGlobal&&paGlobal.debug){console.log("%cVPAID: ","color:white;background:green;font-weight:bolder;padding:2px;",t)}},logWarn:function(t){if(paVid.debug||window.paGlobal&&paGlobal.debug){console.log("%cWARN: ","color:white;background:orangered;font-weight:bolder;padding:2px;",t)}},timeToMili:function(t){if(!t){return 0}var ar=t.split(":");var hh=parseInt(ar[0]);var mm=parseInt(ar[1]);var mili=ar[2].split(".");var ss=parseInt(ar[2]);var mi=0;if(mili[1]){mi=parseInt(mili[1])}totalTime=hh*60*60*1e3+mm*60*1e3+ss*1e3+mi;return totalTime},percentToMili:(percent,totalTime)=>{return totalTime*parseFloat("."+percent)},select:function(n,d){return(d||document).querySelector(n)},selectAll:function(n,d){return(d||document).querySelectorAll(n)},cleanText:function(t){return t.replace(/ /g,"").replace(/\n/g,"").replace(/\r/g,"")},selectText:function(n,d){if(d){return paVid.cleanText(d&&paVid.select(n,d).textContent.trim())}else{return paVid.cleanText(n.textContent.trim())}},att:(att,n)=>{return n.getAttribute(att)},getEmptyEvents:function(){return{impression:[],error:[],progress:{},clickTracking:[],customClick:[],start:[],firstQuartile:[],midpoint:[],thirdQuartile:[],complete:[],mute:[],unmute:[],pause:[],resume:[],fullscreen:[],exitFullscreen:[],closeLinear:[],rewind:[],skip:[],creativeView:[],expand:[],collapse:[],playerExpand:[],playerCollapse:[],acceptInvitation:[],acceptInvitationLinear:[]}},getSupport:()=>{var mp4="video/mp4";var webm="video/webm";var ogg="video/ogg";browserSupport={opera:[mp4,webm,ogg],firefox:[mp4,webm,ogg],safari:[mp4],ie:[mp4],edge:[mp4,webm,ogg],chrome:[mp4,webm,ogg],edgeChrome:[mp4,webm,ogg],blink:[mp4,webm,ogg]};return browserSupport[paVid.browser]},getBrowser:function(){var isOpera=!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0;var isFirefox=typeof InstallTrigger!=="undefined";var isSafari=/constructor/i.test(window.HTMLElement)||function(p){return p&&p.toString()==="[object SafariRemoteNotification]"}(window.safari||typeof safari!=="undefined"&&safari.pushNotification);var isIE=!1||!!document.documentMode;var isEdge=!isIE&&!!window.StyleMedia;var isChrome=!!window.chrome&&(!!window.chrome.webstore||!!window.chrome.runtime);var isEdgeChromium=isChrome&&navigator.userAgent.indexOf("Edg")!=-1;var isBlink=(isChrome||isOpera)&&!!window.CSS;if(isOpera){return"opera"}else if(isFirefox){return"firefox"}else if(isSafari){return"safari"}else if(isIE){return"ie"}else if(isEdge){return"edge"}else if(isChrome){return"chrome"}else if(isEdgeChromium){return"edgeChrome"}else if(isBlink){return"blink"}return"chrome"},sendReport:function(d){if(window.paGlobal&&paGlobal.reporting&&paGlobal.reporting.x){paGlobal.reporting.x(d)}}};